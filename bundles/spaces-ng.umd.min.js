!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("ngx-bowser"),require("@angular/http"),require("rxjs/add/operator/map"),require("@angular/common/http"),require("@angular/router")):"function"==typeof define&&define.amd?define("spaces-ng",["exports","@angular/core","ngx-bowser","@angular/http","rxjs/add/operator/map","@angular/common/http","@angular/router"],e):e(t["spaces-ng"]={},t.ng.core,t.ngxBowser,t.ng.http,t.Rx.Observable.prototype,t.ng.common.http,t.ng.router)}(this,function(t,e,o,i,r,s,n){"use strict";var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};function u(t,e){function o(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var c=function(){function t(t){this.bowser=t,this._logLevel=1,this.useColor=!0,this.defaultBackground="#fff",this.defaultColor="#000",this.criticalBackground="#F296A1",this.criticalColor="#000",this.debugBackground="#9EBABA",this.debugColor="#FFF",this.errorBackground="#F296A1",this.errorColor="#FFF",this.importantBackground="#FF1493",this.importantColor="#000",this.infoBackground="#CCC691",this.infoColor="#000",this.warnBackground="#F5AD89",this.warnColor="#000",this.methodColors={},this.moduleColors={},this.levels={debug:0,info:1,warn:2,error:3,critical:4,important:5},this.browser=this.bowser.bowser.name.toLowerCase(),this.info("Browser",this.browser)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return Object.keys(this.levels)[this._logLevel]},set:function(t){"null"!==this.levels[t]&&(this._logLevel=this.levels[t])},enumerable:!0,configurable:!0}),t.prototype.disableColor=function(){this.useColor=!1},t.prototype.criticalColors=function(t,e){this.criticalBackground=t,this.criticalColor=e},t.prototype.debugColors=function(t,e){this.debugBackground=t,this.debugColor=e},t.prototype.errorColors=function(t,e){this.errorBackground=t,this.errorColor=e},t.prototype.importantColors=function(t,e){this.importantBackground=t,this.importantColor=e},t.prototype.infoColors=function(t,e){this.infoBackground=t,this.infoColor=e},t.prototype.warnColors=function(t,e){this.warnBackground=t,this.warnColor=e},t.prototype.methodColor=function(t,e,o){if(!o){var r=this.methodIndex(),i=new Error,s=i.stack?i.stack.split("\n"):[];if(0<s.length)o=this.parseLogLine(s[r]).method}"null"!==o&&(this.methodColors[o]={bg:t,color:e})},t.prototype.moduleColor=function(t,e,o){if(!o){var r=this.methodIndex(),i=new Error,s=i.stack?i.stack.split("\n"):[];if(0<s.length)o=this.parseLogLine(s[r]).module}"null"!==o&&(this.moduleColors[o]={bg:t,color:e})},t.prototype.log=function(t,e,o,r,i,s,n,a){if(void 0===r&&(r="#fff"),void 0===i&&(i="#000"),void 0===s&&(s="#fff"),void 0===n&&(n="#000"),void 0===a&&(a=undefined),this.levels[t]>=this._logLevel){var u=new Error,c=u.stack?u.stack.split("\n"):[];a===undefined&&(a=this.methodIndex());var h=this.parseLogLine(c[a]);"chrome"===this.browser&&"SafeSubscriber"===h.module&&(h=this.parseLogLine(c[c.length-1]));var p=this.useColor?" %c ":" ",l=[t.toUpperCase(),p,this.getHeader(c[a]),p,e," "].join(" ");this.moduleColors[h.module]&&(r=this.moduleColors[h.module].bg,i=this.moduleColors[h.module].color),this.methodColors[h.method]&&(r=this.methodColors[h.method].bg,i=this.methodColors[h.method].color),this.useColor?console.log(l,this.css(s,l),this.css(r,i),o):console.log(l,o)}},t.prototype.getHeader=function(t){var e,o,r,i,s,n,a,u,c;switch(this.browser){case"chrome":o=t.trim().match(/^at\s(?:new\s)?(\w+)(?:\.)?(\w+)?\s/)||[],r=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[],u=e="",(i=o[1])&&(e+=i,u=":"),(s=o[2])&&(e+=u+s),c="",(n=r[1])&&(e+=" ("+n,c=":"),(a=r[2])&&(e+=c+a+")");break;case"firefox":o=t.trim().match(/(\w+)\.(?:\w+)\.(\w+)@/)||[],r=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[],u=e="",(i=o[1])&&(e+=i,u=":"),(s=o[2])&&(e+=u+s),c="",(n=r[1])&&(e+=" ("+n,c=":"),(a=r[2])&&(e+=c+a+")");break;case"safari":o=t.trim().match(/^(\w+)@/)||[],r=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[],e="",(s=o[1])&&(e+=s),c=u="",(n=r[1])&&(e+=" ("+n,c=":"),(a=r[2])&&(e+=c+a+")");break;default:console.warn("Advanced logging is not supported in browser",this.browser)}return e},t.prototype.parseLogLine=function(t){var e,o,r,i,s,n;return"chrome"===this.browser?(e=t.trim().match(/^at\s(?:new\s)?(\w+)(?:\.)?(\w+)?\s/)||[],o=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[]):"firefox"===this.browser?(e=t.trim().match(/(\w+)\.(?:\w+)\.(\w+)@/)||[],o=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[]):"safari"===this.browser&&(e=t.trim().match(/^(\w+)@/)||[],o=t.trim().match(/(\w+\.\w+)\:([0-9]+\:[0-9]+)/)||[]),e&&(r=e[1]||"NA",i=e[2]||"NA"),o&&(s=o[1]||"?",n=o[2]||"?"),{module:r,method:i,fileName:s,line:n}},t.prototype.methodIndex=function(){var t=3;switch(this.browser){case"chrome":t=3;break;case"firefox":case"safari":t=2;break;default:console.warn("Advanced logging is not supported in browser",this.browser)}return t},t.prototype.critical=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("critical",t,e,o,r,this.criticalBackground,this.criticalColor)},t.prototype.debug=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("debug",t,e,o,r,this.debugBackground,this.debugColor)},t.prototype.error=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("error",t,e,o,r,this.errorBackground,this.errorColor)},t.prototype.info=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("info",t,e,o,r,this.infoBackground,this.infoColor)},t.prototype.important=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("important",t,e,o,r,this.importantBackground,this.importantColor)},t.prototype.warn=function(t,e,o,r){void 0===e&&(e=""),void 0===o&&(o=this.defaultBackground),void 0===r&&(r=this.defaultColor),this.log("warn",t,e,o,r,this.warnBackground,this.warnColor)},t.prototype.css=function(t,e){return["background: ",t+"; ","color: ",e+";"].join(" ")},t}();c.decorators=[{type:e.Injectable}],c.ctorParameters=function(){return[{type:o.BowserService}]};var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.encodeKey=function(t){return encodeURIComponent(t)},e.prototype.encodeValue=function(t){return encodeURIComponent(t)},e}(i.QueryEncoder),p=function(){function t(t,e){var o=this;this.http=t,this.logging=e,this._initialized=!1,this.logging.moduleColor("#2878b7","#fff","SpacesBaseService"),this.initPromise=new Promise(function(t,e){o.initPromiseResolver=t,o.initPromiseRejector=e})}return t.prototype.resolve=function(t,e){return console.log("resolve"),console.log("route.queryParamMap.keys",t.queryParamMap.keys),this._initialized||(console.log("Got params "+t.queryParamMap),this._params=t.queryParams,console.log("this._params",this._params),console.log("route.queryParamMap",t.queryParamMap),console.log("route.queryParams",t.queryParams),this._tcToken=decodeURIComponent(this._params.tcToken),console.log("this._tcToken",this._tcToken),this._tcTokenExpires=this._params.tcTokenExpires,this._initialized=!0,this.initPromiseResolver()),this.initPromise},Object.defineProperty(t.prototype,"initialized",{get:function(){return this.initPromise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),t.prototype.param=function(t){if(this.initialized){var e=this._params[t];return e!==undefined&&(e=decodeURIComponent(e.replace("+"," "))),e}return this.logging.warn("Service is not intialized.",""),""},Object.defineProperty(t.prototype,"tcApiPath",{get:function(){return this.param("tcApiPath")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tcProxyServer",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tcSpaceElementId",{get:function(){return this.param("tcSpaceElementId")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tcToken",{get:function(){var t=(new Date).getTime()/1e3+15;if(!(this._tcTokenExpires<t))return this._tcToken;this.tcTokenRenew()},enumerable:!0,configurable:!0}),t.prototype.tcTokenRenew=function(){var o=this,t=new i.URLSearchParams("",new h),e=new i.RequestOptions({method:i.RequestMethod.Get,search:t});t.set("expiredToken",this._tcToken);var r=[this._params.tcApiPath,"appAuth"].join("/");this.http.request(r,e).subscribe(function(t){o.logging.debug("res",t);var e=t.json();return!0===e.success&&(o._tcToken=e.apiToken,o._tcTokenExpires=e.apiTokenExpires),o._tcToken},function(t){return o.logging.error("Token Renewal Error",t),o._tcToken})},t.prototype.handleAjaxError=function(t){var e=t.text();return this.logging.error("spaces_base.service: request to "+t.url+" failed with: ",e),Promise.reject(e||t)},t}();p.decorators=[{type:e.Injectable}],p.ctorParameters=function(){return[{type:i.Http},{type:c}]};var l=function(){function t(t){this.logging=t,this.msgs=[],this.logging.moduleColor("#00008b","#fff","SpacesMessagesService")}return t.prototype.showSuccess=function(t,e){this.showMessage("success",t,e)},t.prototype.showInfo=function(t,e){this.showMessage("info",t,e)},t.prototype.showWarning=function(t,e){this.showMessage("warn",t,e)},t.prototype.showError=function(t,e){this.showMessage("error",t,e)},t.prototype.showMessage=function(t,e,o){this.clearMessages(),this.msgs.push({severity:t,summary:e,detail:o})},t.prototype.clearMessages=function(){this.msgs=[]},t}();l.decorators=[{type:e.Injectable}],l.ctorParameters=function(){return[{type:c}]};var g=function(){function t(t){this.spacesBase=t}return t.prototype.resolve=function(t){return console.log("BCS",this.spacesBase.params),t.queryParams},t}();g.decorators=[{type:e.Injectable}],g.ctorParameters=function(){return[{type:p}]};var d=function(o){function t(t){var e=o.call(this)||this;return e.logging=t,e}return u(t,o),t.prototype.encodeKey=function(t){return this.logging.info("Query Encoder","Got key "+t),encodeURIComponent(t)},t.prototype.encodeValue=function(t){return this.logging.info("Query Encoder","Got value "+t),encodeURIComponent(t)},t}(i.QueryEncoder),f=function(){function t(t,e,o){this.http=t,this.logging=e,this.spacesBase=o,this.headers=new i.Headers,this.params=new i.URLSearchParams("",new d(this.logging)),this.options=new i.RequestOptions({headers:this.headers,method:i.RequestMethod.Get,params:this.params}),this.logging.moduleColor("#2878b7","#fff","SpacesRequestService")}return t.prototype.method=function(t){switch(this.logging.debug("data",t),t.toUpperCase()){case"DELETE":this.options.method=i.RequestMethod.Delete;break;case"GET":this.options.method=i.RequestMethod.Get;break;case"POST":this.options.method=i.RequestMethod.Post;break;case"PUT":this.options.method=i.RequestMethod.Put;break;default:this.options.method=i.RequestMethod.Get}return this},t.prototype.proxy=function(t){return this.logging.debug("data",t),this.useProxy=t,this},t.prototype.url=function(t){return this.logging.debug("data",t),this.requestUrl=t,this},t.prototype.header=function(t,e){return this.headers.set(t,e),this.logging.debug("key",t),this.logging.debug("val",e),this},t.prototype.authorization=function(t){return this.logging.debug("data",t),this.header("Authorization",t),this},t.prototype.contentType=function(t){return this.logging.debug("data",t),this.header("Content-Type",t),this},t.prototype.body=function(t){return this.logging.debug("data",t),this.options.body=t,this},t.prototype.param=function(t,e){return this.logging.debug("key",t),this.logging.debug("val",e),this.params.set(t,e),this},t.prototype.createActivityLog=function(t){return this.logging.debug("data",t),this.param("createActivityLog",String(t)),this},t.prototype.modifiedSince=function(t){return this.logging.debug("data",t),this.param("modifiedSince",t),this},t.prototype.owner=function(t){return this.param("owner",t),this},t.prototype.resultLimit=function(t){return this.logging.debug("data",t),this.param("resultLimit",String(t)),this},t.prototype.resultStart=function(t){return this.logging.debug("data",t),this.param("resultStart",String(t)),this},t.prototype.proxyUrl=function(){var t=new i.URLSearchParams;t.set("_targetUrl",this.requestUrl),t.appendAll(this.params),this.options.search=t,this.spacesBase.tcProxyServer?this.requestUrl=this.spacesBase.tcProxyServer+"/secureProxy":this.requestUrl=window.location.protocol+"//"+window.location.host+"/secureProxy",this.logging.debug("this.requestUrl",this.requestUrl)},t.prototype.request=function(){var e=this;return this.logging.debug("this.requestUrl",this.requestUrl),this.logging.debug("this.options",this.options),this.logging.debug("this.useProxy",this.useProxy),this.options.params=this.params,this.options.headers=this.headers,this.useProxy&&this.proxyUrl(),this.http.request(this.requestUrl,this.options).map(function(t){return e.logging.info("res.url",t.url),e.logging.info("res.status",t.status),t},function(t){e.logging.error("error",t)})},t.prototype.resetOptions=function(){return this.logging.info("resetOptions","resetOptions"),this.headers=new i.Headers,this.headers.set("Accept","application/json"),this.params=new i.URLSearchParams("",new d(this.logging)),this.useProxy=!1,this.options=new i.RequestOptions({headers:this.headers,method:i.RequestMethod.Get,search:this.params}),this},t.prototype.handleAjaxError=function(t){var e=t.text();return this.logging.error("Error","request to "+t.url+" failed with: "+e),Promise.reject(e||t)},t}();f.decorators=[{type:e.Injectable}],f.ctorParameters=function(){return[{type:i.Http},{type:c},{type:p}]};var m=function(){function t(t){this.logging=t,this.storage={},this.logging.moduleColor("#00008b","#fff","SpacesStorageService")}return t.prototype.ngOnInit=function(){},t.prototype.create=function(t,e){this.storage[t]=e},t.prototype.read=function(t){return this.storage[t]},t.prototype["delete"]=function(t){delete this.storage[t]},t.prototype.update=function(t,e){this.storage[t]=e},t}();m.decorators=[{type:e.Injectable}],m.ctorParameters=function(){return[{type:c}]};var y=function(){function t(t){this.logging=t,this.logging.moduleColor("#2878b7","#fff","SpacesUtilityService")}return t.prototype.isEmpty=function(t){var e=!0;return 0<Object.keys(t).length&&t.constructor===Object&&(e=!1),e},t.prototype.findIndex=function(t,e){return t.indexOf(e)},t}();y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:c}]};var b=function(){function t(t,e,o){this.http=t,this.spacesBaseService=e,this.router=o,this.missingParams=[],this.done=!1}return t.prototype.ngOnInit=function(){var o=this;this.spacesBaseService.initialized.then(function(){var e=o.spacesBaseService.params;if("true"===e.develop)return o.done=!0,void o.router.navigate(["app"]);o.http.get("install.json",{responseType:"json"}).subscribe(function(t){o.missingParams=t.params.filter(function(t){return t.required}).filter(function(t){return!e[t.name]}),o.done=!0,0===o.missingParams.length&&o.router.navigate(["app"])},function(t){console.log(t)})})},t}();b.decorators=[{type:e.Component,args:[{selector:"spaces-landing-page",template:'<div *ngIf="!done" class="centered">\n  <h4>Checking parameters</h4>\n</div>\n<div *ngIf="done && missingParams.length > 0" class="centered">\n  <h4>You must configure parameters to use this app.</h4>\n</div>\n',styles:[".centered{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;margin-top:150px}"]}]}],b.ctorParameters=function(){return[{type:s.HttpClient},{type:p},{type:n.Router}]};var v=function(){};v.decorators=[{type:e.NgModule,args:[{declarations:[b],exports:[b],imports:[o.BowserModule],providers:[p,c,l,g,f,m,y]}]}],v.ctorParameters=function(){return[]},t.SpacesBaseService=p,t.SpacesLoggingService=c,t.SpacesMessagesService=l,t.SpacesParamsResolve=g,t.SpacesRequestService=f,t.SpacesStorageService=m,t.SpacesUtilityService=y,t.SpacesModule=v,t.ɵa=b,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=spaces-ng.umd.min.js.map
